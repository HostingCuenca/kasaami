<?php
// Testimonios data - Se puede mover a un archivo de configuración separado
$testimonios = [
    'es' => [
        'title' => 'Voces que Inspiran Transformación',
        'subtitle' => 'Historias reales de pacientes que eligieron Ecuador para renovarse, sanar y redescubrir su belleza con Kasaami',
        'testimonials' => [
            [
                'text' => 'La experiencia completa fue excepcional. Desde la primera consulta hasta la recuperación, me sentí cuidada y acompañada. Los resultados superaron mis expectativas.',
                'name' => 'María González',
                'procedure' => 'Rinoplastia',
                'image' => 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'
            ],
            [
                'text' => 'No solo obtuve los resultados que buscaba, sino que pude conocer la belleza de Ecuador. El equipo médico es de primer nivel y el trato humano incomparable.',
                'name' => 'Jessica Thompson',
                'procedure' => 'Aumento de Senos',
                'image' => 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'
            ],
            [
                'text' => 'Decidir operarme en Ecuador fue la mejor decisión. La calidad médica es excepcional y los costos son muy accesibles comparado con Estados Unidos.',
                'name' => 'Carlos Mendoza',
                'procedure' => 'Liposucción',
                'image' => 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'
            ],
            [
                'text' => 'El profesionalismo y la atención personalizada hicieron que mi experiencia fuera increíble. Me sentí segura en todo momento y los resultados son naturales y hermosos.',
                'name' => 'Ana Rodríguez',
                'procedure' => 'Lifting Facial',
                'image' => 'https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'
            ],
            [
                'text' => 'La combinación de turismo médico y la belleza de Ecuador hizo que mi recuperación fuera única. El equipo siempre estuvo disponible para cualquier consulta.',
                'name' => 'Michael Johnson',
                'procedure' => 'Trasplante Capilar',
                'image' => 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'
            ],
            [
                'text' => 'Desde la primera videollamada hasta el último día de mi estadía, todo fue perfecto. La coordinación fue excelente y me sentí como en casa desde el primer momento.',
                'name' => 'Sophie Laurent',
                'procedure' => 'Abdominoplastia',
                'image' => 'https://images.unsplash.com/photo-1554151228-14d9def656e4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'
            ],
            [
                'text' => 'La calidad de las instalaciones y la tecnología utilizada me sorprendió gratamente. Recomiendo completamente esta experiencia a cualquiera que esté considerando una cirugía.',
                'name' => 'Roberto Silva',
                'procedure' => 'Ginecomastia',
                'image' => 'https://images.unsplash.com/photo-1560250097-0b93528c311a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'
            ],
            [
                'text' => 'Mi cirugía de mamoplastia fue un éxito total. El Dr. me explicó todo el proceso y los resultados son exactamente lo que esperaba. Estoy muy feliz con mi decisión.',
                'name' => 'Isabella García',
                'procedure' => 'Mamoplastia de Reducción',
                'image' => 'https://images.unsplash.com/photo-1556157382-97eda2d62296?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'
            ],
            [
                'text' => 'Ecuador me sorprendió no solo por la calidad médica sino por su cultura y paisajes. Fue una experiencia de transformación completa, tanto física como personal.',
                'name' => 'David Thompson',
                'procedure' => 'Blefaroplastia',
                'image' => 'https://images.unsplash.com/photo-1492562080023-ab3db95bfbce?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'
            ]
        ]
    ],
    'en' => [
        'title' => 'Voices that Inspire Transformation',
        'subtitle' => 'Real stories of patients who chose Ecuador to renew themselves, heal and rediscover their beauty with Kasaami',
        'testimonials' => [
            [
                'text' => 'The complete experience was exceptional. From the first consultation to recovery, I felt cared for and accompanied. The results exceeded my expectations.',
                'name' => 'María González',
                'procedure' => 'Rhinoplasty',
                'image' => 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'
            ],
            [
                'text' => 'Not only did I get the results I was looking for, but I was able to discover the beauty of Ecuador. The medical team is first class and the human treatment incomparable.',
                'name' => 'Jessica Thompson',
                'procedure' => 'Breast Augmentation',
                'image' => 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'
            ],
            [
                'text' => 'Deciding to have surgery in Ecuador was the best decision. The medical quality is exceptional and the costs are very affordable compared to the United States.',
                'name' => 'Carlos Mendoza',
                'procedure' => 'Liposuction',
                'image' => 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'
            ],
            [
                'text' => 'The professionalism and personalized attention made my experience incredible. I felt safe at all times and the results are natural and beautiful.',
                'name' => 'Ana Rodríguez',
                'procedure' => 'Facelift',
                'image' => 'https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'
            ],
            [
                'text' => 'The combination of medical tourism and the beauty of Ecuador made my recovery unique. The team was always available for any consultation.',
                'name' => 'Michael Johnson',
                'procedure' => 'Hair Transplant',
                'image' => 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'
            ],
            [
                'text' => 'From the first video call to the last day of my stay, everything was perfect. The coordination was excellent and I felt at home from the first moment.',
                'name' => 'Sophie Laurent',
                'procedure' => 'Tummy Tuck',
                'image' => 'https://images.unsplash.com/photo-1554151228-14d9def656e4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'
            ],
            [
                'text' => 'The quality of the facilities and the technology used pleasantly surprised me. I completely recommend this experience to anyone considering surgery.',
                'name' => 'Roberto Silva',
                'procedure' => 'Gynecomastia',
                'image' => 'https://images.unsplash.com/photo-1560250097-0b93528c311a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'
            ],
            [
                'text' => 'My breast reduction surgery was a total success. The doctor explained the entire process to me and the results are exactly what I expected. I am very happy with my decision.',
                'name' => 'Isabella García',
                'procedure' => 'Breast Reduction',
                'image' => 'https://images.unsplash.com/photo-1556157382-97eda2d62296?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'
            ],
            [
                'text' => 'Ecuador surprised me not only with its medical quality but also with its culture and landscapes. It was a complete transformation experience, both physical and personal.',
                'name' => 'David Thompson',
                'procedure' => 'Blepharoplasty',
                'image' => 'https://images.unsplash.com/photo-1492562080023-ab3db95bfbce?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'
            ]
        ]
    ]
];

$testimoniosData = $testimonios[$currentLang];
?>

<!-- Testimonials Section with Simple Infinite Carousel -->
<section class="py-20 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="text-center mb-16">
            <h2 class="text-4xl md:text-5xl font-rufina font-bold text-gray-900 mb-6">
                <?php echo $testimoniosData['title']; ?>
            </h2>
            <p class="text-xl text-gray-600">
                <?php echo $testimoniosData['subtitle']; ?>
            </p>
        </div>
        
        <!-- Carousel Container -->
        <div class="relative max-w-4xl mx-auto">
            <!-- Testimonials Carousel -->
            <div class="overflow-hidden rounded-2xl">
                <div class="testimonials-carousel flex transition-transform duration-1500 ease-in-out" id="testimonials-track">
                    <?php 
                    // Triple testimonials for smooth infinite effect
                    $allTestimonials = array_merge($testimoniosData['testimonials'], $testimoniosData['testimonials'], $testimoniosData['testimonials']);
                    foreach($allTestimonials as $index => $testimonial): 
                    ?>
                    <div class="testimonial-slide w-full flex-shrink-0">
                        <div class="testimonial-card bg-white p-8 rounded-2xl border border-gray-200 mx-4 transition-all duration-300 hover:border-kasaami-violet">
                            <!-- Stars -->
                            <div class="flex items-center justify-center mb-6">
                                <?php for($i = 0; $i < 5; $i++): ?>
                                <svg class="w-5 h-5 text-yellow-400 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                </svg>
                                <?php endfor; ?>
                            </div>
                            
                            <!-- Testimonial Text -->
                            <blockquote class="text-gray-600 mb-8 italic leading-relaxed text-center text-lg">
                                "<?php echo $testimonial['text']; ?>"
                            </blockquote>
                            
                            <!-- Patient Info -->
                            <div class="flex items-center justify-center">
                                <img 
                                    src="<?php echo $testimonial['image']; ?>" 
                                    alt="<?php echo $testimonial['name']; ?>"
                                    class="w-16 h-16 rounded-full object-cover mr-4 border-2 border-kasaami-violet/20"
                                    loading="lazy"
                                >
                                <div class="text-left">
                                    <p class="font-semibold text-gray-900 text-lg"><?php echo $testimonial['name']; ?></p>
                                    <p class="text-kasaami-violet text-sm font-medium"><?php echo $testimonial['procedure']; ?></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <?php endforeach; ?>
                </div>
            </div>
            
            <!-- Navigation Arrows -->
            <button 
                class="testimonials-prev absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-4 bg-white rounded-full p-3 shadow-md hover:shadow-lg transition-all duration-300 z-10 border border-gray-200"
                aria-label="Previous testimonial"
            >
                <svg class="w-6 h-6 text-kasaami-violet" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
            </button>
            
            <button 
                class="testimonials-next absolute right-0 top-1/2 transform -translate-y-1/2 translate-x-4 bg-white rounded-full p-3 shadow-md hover:shadow-lg transition-all duration-300 z-10 border border-gray-200"
                aria-label="Next testimonial"
            >
                <svg class="w-6 h-6 text-kasaami-violet" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
            </button>
            
            <!-- Dots Indicator -->
            <div class="flex justify-center space-x-2 mt-8" id="testimonials-dots">
                <!-- Dots will be generated by JavaScript -->
            </div>
        </div>
    </div>
</section>

<style>
/* Simple Testimonials Carousel */
.testimonials-carousel {
    will-change: transform;
}

.testimonials-carousel.no-transition {
    transition: none !important;
}

.testimonial-card {
    min-height: 300px;
    background: linear-gradient(135deg, #ffffff 0%, #fafbff 100%);
}

.testimonial-card:hover {
    background: linear-gradient(135deg, #fafbff 0%, #f3f4f6 100%);
}

/* Navigation buttons */
.testimonials-prev:hover,
.testimonials-next:hover {
    transform: translateY(-50%) scale(1.05);
    background-color: #f8fafc;
}

/* Dots styling */
.carousel-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: #d1d5db;
    cursor: pointer;
    transition: all 0.3s ease;
}

.carousel-dot.active {
    background-color: #8B5CF6;
    transform: scale(1.2);
}

.carousel-dot:hover {
    background-color: #9ca3af;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
    .testimonials-prev,
    .testimonials-next {
        display: none;
    }
    
    .testimonial-card {
        margin: 0 8px;
        min-height: 280px;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const testimonials = <?php echo json_encode($testimoniosData['testimonials']); ?>;
    const track = document.getElementById('testimonials-track');
    const dotsContainer = document.getElementById('testimonials-dots');
    const prevBtn = document.querySelector('.testimonials-prev');
    const nextBtn = document.querySelector('.testimonials-next');
    
    const totalTestimonials = testimonials.length;
    let currentIndex = totalTestimonials; // Start at the middle set for seamless loop
    let autoPlayInterval;
    let isTransitioning = false;
    
    // Create dots
    function createDots() {
        dotsContainer.innerHTML = '';
        for (let i = 0; i < totalTestimonials; i++) {
            const dot = document.createElement('div');
            dot.className = `carousel-dot ${i === 0 ? 'active' : ''}`;
            dot.addEventListener('click', () => goToSlide(i));
            dotsContainer.appendChild(dot);
        }
    }
    
    // Update active dot
    function updateDots() {
        const dots = dotsContainer.querySelectorAll('.carousel-dot');
        const realIndex = currentIndex % totalTestimonials;
        dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === realIndex);
        });
    }
    
    // Move carousel
    function moveCarousel(withTransition = true) {
        if (!withTransition) {
            track.classList.add('no-transition');
        } else {
            track.classList.remove('no-transition');
        }
        
        const translateX = -(currentIndex * 100);
        track.style.transform = `translateX(${translateX}%)`;
        updateDots();
        
        if (!withTransition) {
            track.offsetHeight; // Force reflow
            track.classList.remove('no-transition');
        }
    }
    
    // Go to specific slide
    function goToSlide(slideIndex) {
        if (isTransitioning) return;
        currentIndex = slideIndex + totalTestimonials; // Use middle set
        moveCarousel();
        resetAutoPlay();
    }
    
    // Next slide
    function nextSlide() {
        if (isTransitioning) return;
        
        isTransitioning = true;
        currentIndex++;
        moveCarousel();
        
        setTimeout(() => {
            // Reset to middle set if at the end
            if (currentIndex >= totalTestimonials * 2) {
                currentIndex = totalTestimonials;
                moveCarousel(false);
            }
            isTransitioning = false;
        }, 500);
    }
    
    // Previous slide
    function prevSlide() {
        if (isTransitioning) return;
        
        isTransitioning = true;
        currentIndex--;
        moveCarousel();
        
        setTimeout(() => {
            // Reset to middle set if at the beginning
            if (currentIndex < totalTestimonials) {
                currentIndex = totalTestimonials * 2 - 1;
                moveCarousel(false);
            }
            isTransitioning = false;
        }, 500);
    }
    
    // Auto-play
    function startAutoPlay() {
        autoPlayInterval = setInterval(nextSlide, 4000);
    }
    
    function stopAutoPlay() {
        if (autoPlayInterval) {
            clearInterval(autoPlayInterval);
        }
    }
    
    function resetAutoPlay() {
        stopAutoPlay();
        startAutoPlay();
    }
    
    // Event listeners
    if (nextBtn) nextBtn.addEventListener('click', () => {
        nextSlide();
        resetAutoPlay();
    });
    
    if (prevBtn) prevBtn.addEventListener('click', () => {
        prevSlide();
        resetAutoPlay();
    });
    
    // Pause on hover
    const carousel = track.parentElement;
    carousel.addEventListener('mouseenter', stopAutoPlay);
    carousel.addEventListener('mouseleave', startAutoPlay);
    
    // Touch support
    let startX = 0;
    let endX = 0;
    
    track.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
        stopAutoPlay();
    });
    
    track.addEventListener('touchend', (e) => {
        endX = e.changedTouches[0].clientX;
        const diff = startX - endX;
        
        if (Math.abs(diff) > 50) {
            if (diff > 0) {
                nextSlide();
            } else {
                prevSlide();
            }
        }
        resetAutoPlay();
    });
    
    // Initialize
    createDots();
    moveCarousel(false);
    startAutoPlay();
});
</script>